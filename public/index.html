<!DOCTYPE html>
<html>
    <head>
        <title>AutumnContourGL</title>
        <script src='https://unpkg.com/maplibre-gl@latest/dist/maplibre-gl.js'></script>
        <link href='https://unpkg.com/maplibre-gl@latest/dist/maplibre-gl.css' rel='stylesheet' />
        <script src="autumn-contour-gl.js"></script>
        <script>
            const nx = 121, ny = 61;
            const grid = new acgl.PlateCarreeGrid(nx, ny, -130, 20, -65, 55);
            let hght = [], u = [], v = [];
            for (i = 0; i < nx; i++) {
                for (j = 0; j < ny; j++) {
                    const idx = i + j * nx;
                    hght[idx] = 10 * Math.cos(6 * Math.PI * i / (nx - 1)) * Math.cos(3 * Math.PI * j / (ny - 1));
                    u[idx] = 30 * Math.cos(6 * Math.PI * i / (nx - 1)) * Math.sin(3 * Math.PI * j / (ny - 1));
                    v[idx] = -30 * Math.sin(6 * Math.PI * i / (nx - 1)) * Math.cos(3 * Math.PI * j / (ny - 1));
                }
            }

            const colormap = acgl.Colormap.bluered(-10, 10, 20);
            const svg = acgl.makeColorbar(colormap, {label: "Height Perturbation (m)", fontface: 'Trebuchet MS', ticks: [-10, -8, -6, -4, -2, 0, 2, 4, 6, 8, 10],
                                                     orientation: 'horizontal', tick_direction: 'bottom'});

            const raw_hght_field = new acgl.RawDataField(grid, new Float32Array(hght));
            const raw_u_field = new acgl.RawDataField(grid, new Float32Array(u));
            const raw_v_field = new acgl.RawDataField(grid, new Float32Array(v));

            const cntr = new acgl.FieldContour(raw_hght_field, {interval: 1, color: '#000000', thinner: zoom => zoom < 5 ? 2 : 1});
            const filled = new acgl.FieldContourFill(raw_hght_field, {'cmap': colormap, 'opacity': 0.6});
            const barbs = new acgl.FieldBarbs({'u': raw_u_field, 'v': raw_v_field}, {color: '#000000', thin_fac: 16});

            const hght_layer = new acgl.AutumnFieldLayer('height', cntr);
            const hght_fill_layer = new acgl.AutumnFieldLayer('height-fill', filled);
            const barb_layer = new acgl.AutumnFieldLayer('barbs', barbs);
        </script>
        <style>
            body {
                margin: 0px;
            }

            div#colorbar.left {
                position: absolute;
                display:inline-block;
                width: 65px;
                height: 100vh;
                z-index: 10;
                background-color: #ffffffbb;
            }
            div#colorbar.left svg {
                position: absolute;
                top: 50%;
                transform: translate(0, -50%);
            }

            div#colorbar.bottom {
                position: absolute;
                display:inline-block;
                bottom: 0%;
                width: 100%;
                height: 67px;
                z-index: 10;
                background-color: #ffffffbb;
            }
            div#colorbar.bottom svg {
                position: absolute;
                bottom: 0%;
                left: 50%;
                transform: translate(-50%, 0);
            }

            div#map {
                display: inline-block;
                width: 100%;
                height: 100vh;
            }
        </style>
    </head>
    <body>
        <div id='colorbar' class="bottom"></div>
        <div id='map'></div>
        <script>
        const map = new maplibregl.Map({
            container: 'map',
            style: 'https://api.maptiler.com/maps/basic-v2/style.json?key=UWqkVQQbiXnCvm3VQ2BF', // stylesheet location
            center: [-100.5, 35.5], // starting position [lng, lat]
            zoom: 6 // starting zoom
        });
        
        map.on('load', () => {
            map.addLayer(hght_fill_layer, 'railway_transit_tunnel');
            map.addLayer(hght_layer, 'railway_transit_tunnel');
            map.addLayer(barb_layer, 'railway_transit_tunnel');
        });

        document.getElementById('colorbar').appendChild(svg);
        </script>
    </body>
</html>